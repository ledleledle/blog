<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Maafkan saya yang akhir-akhir ini tidak menulis blog (2 bulan), dikarenakan kerjaan yang padat dan manajemen waktu yang buruk. Namun sekarang saya senggang dan mampu untuk menulis blog.
Intro Kadang untuk alasan privasi atau mencari kecepatan dalam deployment, seseorang atau suatu perusahaan akan memilih untuk membuat Container Registry-nya sendiri, apalagi sekarang lagi populer banget development aplikasi menggunakan kontainer, cocok banget. Untuk itu dibuatlah artikel ini. Namun pada artikel ini saya hanya akan memberikan contoh kecilnya saja, yang mungkin bisa kalian kembangkan misal kalian ingin membuat cluster container registry, dsb."><title>Membuat Private Registry</title><link rel=canonical href=https://blog.leonprasetya.my.id/p/membuat-private-registry/><link rel=stylesheet href=/scss/style.min.css><meta property="og:title" content="Membuat Private Registry"><meta property="og:description" content="Maafkan saya yang akhir-akhir ini tidak menulis blog (2 bulan), dikarenakan kerjaan yang padat dan manajemen waktu yang buruk. Namun sekarang saya senggang dan mampu untuk menulis blog.
Intro Kadang untuk alasan privasi atau mencari kecepatan dalam deployment, seseorang atau suatu perusahaan akan memilih untuk membuat Container Registry-nya sendiri, apalagi sekarang lagi populer banget development aplikasi menggunakan kontainer, cocok banget. Untuk itu dibuatlah artikel ini. Namun pada artikel ini saya hanya akan memberikan contoh kecilnya saja, yang mungkin bisa kalian kembangkan misal kalian ingin membuat cluster container registry, dsb."><meta property="og:url" content="https://blog.leonprasetya.my.id/p/membuat-private-registry/"><meta property="og:site_name" content="Leon's Blog"><meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:tag" content="docker"><meta property="article:tag" content="registry"><meta property="article:tag" content="devops"><meta property="article:published_time" content="2021-05-21T14:53:48+07:00"><meta property="article:modified_time" content="2021-05-21T14:53:48+07:00"><meta property="og:image" content="https://blog.leonprasetya.my.id/p/membuat-private-registry/private.png"><meta name=twitter:title content="Membuat Private Registry"><meta name=twitter:description content="Maafkan saya yang akhir-akhir ini tidak menulis blog (2 bulan), dikarenakan kerjaan yang padat dan manajemen waktu yang buruk. Namun sekarang saya senggang dan mampu untuk menulis blog.
Intro Kadang untuk alasan privasi atau mencari kecepatan dalam deployment, seseorang atau suatu perusahaan akan memilih untuk membuat Container Registry-nya sendiri, apalagi sekarang lagi populer banget development aplikasi menggunakan kontainer, cocok banget. Untuk itu dibuatlah artikel ini. Namun pada artikel ini saya hanya akan memberikan contoh kecilnya saja, yang mungkin bisa kalian kembangkan misal kalian ingin membuat cluster container registry, dsb."><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://blog.leonprasetya.my.id/p/membuat-private-registry/private.png"><link rel="shortcut icon" href=img/favicon.ico><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga('create','G-6CEFZGZSW6','auto'),ga('send','pageview'))</script><script async src=https://www.google-analytics.com/analytics.js></script></head><body><script>(function(){const a='StackColorScheme';localStorage.getItem(a)||localStorage.setItem(a,"auto")})()</script><script>(function(){const b='StackColorScheme',a=localStorage.getItem(b),c=window.matchMedia('(prefers-color-scheme: dark)').matches===!0;a=='dark'||a==='auto'&&c?document.body.dataset.scheme='dark':document.body.dataset.scheme='light'})()</script><div class="container main-container flex on-phone--column extended article-page with-toolbar"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header class=site-info><figure class=site-avatar><img src=/img/avatar_hu2fbf49c47ab5c26e541d9bd2a2e23b3b_572909_300x0_resize_q75_box.jpg width=300 height=301 class=site-logo loading=lazy alt=Avatar>
<span class=emoji>üßê</span></figure><h1 class=site-name><a href=https://blog.leonprasetya.my.id>Leon's Blog</a></h1><h2 class=site-description>DevOps Engineer</h2></header><ol class=menu id=main-menu><li><a href=/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg><span>Home</span></a></li><li><a href=/about><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg><span>About</span></a></li><li><a href=/archives><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg><span>Archives</span></a></li><li><a href=/tags><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-tag" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11 3l9 9a1.5 1.5.0 010 2l-6 6a1.5 1.5.0 01-2 0L3 11V7a4 4 0 014-4h4"/><circle cx="9" cy="9" r="2"/></svg><span>Tags</span></a></li><li><a href=/search><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg><span>Search</span></a></li><li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><span>Dark Mode</span></li></ol></aside><main class="main full-width"><div id=article-toolbar><a href=https://blog.leonprasetya.my.id class=back-home><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="15 6 9 12 15 18"/></svg><span>Back</span></a></div><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/p/membuat-private-registry/><img src=/p/membuat-private-registry/private_hu96599f47c348a283a1b794be0a0813f9_135854_800x0_resize_box_2.png srcset="/p/membuat-private-registry/private_hu96599f47c348a283a1b794be0a0813f9_135854_800x0_resize_box_2.png 800w, /p/membuat-private-registry/private_hu96599f47c348a283a1b794be0a0813f9_135854_1600x0_resize_box_2.png 1600w" width=800 height=385 loading=lazy alt="Featured image of post Membuat Private Registry"></a></div><div class=article-details><header class=article-category><a href=/categories/devops/>DevOps</a></header><h2 class=article-title><a href=/p/membuat-private-registry/>Membuat Private Registry</a></h2><footer class=article-time><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><time class=article-time--published>May 21, 2021</time></footer></div></header><section class=article-content><p>Maafkan saya yang akhir-akhir ini tidak menulis blog (2 bulan), dikarenakan kerjaan yang padat dan manajemen waktu yang buruk. Namun sekarang saya senggang dan mampu untuk menulis blog.</p><h2 id=intro>Intro</h2><p>Kadang untuk alasan privasi atau mencari kecepatan dalam deployment, seseorang atau suatu perusahaan akan memilih untuk membuat <strong>Container Registry</strong>-nya sendiri, apalagi sekarang lagi populer banget development aplikasi menggunakan kontainer, cocok banget. Untuk itu dibuatlah artikel ini. Namun pada artikel ini saya hanya akan memberikan contoh kecilnya saja, yang mungkin bisa kalian kembangkan misal kalian ingin membuat cluster container registry, dsb. Okay langsung saja.</p><h2 id=requirement>Requirement</h2><ul><li>Docker</li><li>Docker Compose</li><li>Nginx</li><li>Certbot/LetsEncrypt (HTTPS bro/gak wajib)</li><li>Sebuah domain (jika anda orang yang mampu/gak wajib)</li></ul><h2 id=susunan-file--directory>Susunan file & directory</h2><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>container-registry
‚îú‚îÄ‚îÄ auth
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ htpasswd
‚îú‚îÄ‚îÄ docker-compose.yaml
‚îî‚îÄ‚îÄ registry
</code></pre></div><p>Berikut adalah susunan file & directory yang akan digunakan, asumsikan folder utama kita (workdir) bernama <strong>container-registry</strong>, didalamnya ada directory bernama auth dan registry, <strong>auth</strong> berisi file <strong>htpasswd</strong> yang berguna untuk menyimpan user & password sedangkan directory <strong>registry</strong> adalah folder yang akan digunakan untuk menyimpan semua image yang dipush oleh user. Dan jangan lupakan file <strong>docker-compose.yaml</strong>, file yang berisi konfigurasi kontainer.</p><h2 id=step-by-step>Step-by-step</h2><p>Ya&mldr; HTTPS dan domain itu tidak wajib karena tidak semua orang memiliki uang yang cukup untuk membeli sebuah domain (seperti saya). Sebenarnya untuk login docker registry membutuhkan request HTTPS, tapi kita bisa mem-<em>bypass</em>nya, nanti bakal saya jelasin diakhir artikel.</p><h3 id=docker-compose-file>Docker-compose file</h3><p>Pertama, kita akan mendeploy sebuah container registry, dan untungnya Docker sudah membuat imagenya agar kita bisa lebih mudah dalam membuat container registry secara pribadi. Pada artikel ini dibuat, docker registry masih dalam versi <strong>2.7.0</strong>. Jika ingin menggunakan versi terbaru kalian bisa cek pada <a class=link href="https://hub.docker.com/_/registry?tab=tags&page=1&ordering=last_updated" target=_blank rel=noopener>Docker Hub</a>.</p><div class=highlight><pre class=chroma><code class=language-docker data-lang=docker>version: <span class=s2>&#34;3.0&#34;</span><span class=err>
</span><span class=err></span>services:<span class=err>
</span><span class=err></span>    registry:<span class=err>
</span><span class=err></span>        image: registry:2.7.0<span class=err>
</span><span class=err></span>        restart: always<span class=err>
</span><span class=err></span>        ports: <span class=err>
</span><span class=err></span>            - 5000:5000<span class=err>
</span><span class=err></span>        environment:<span class=err>
</span><span class=err></span>            REGISTRY_AUTH: htpasswd<span class=err>
</span><span class=err></span>            REGISTRY_AUTH_HTPASSWD_PATH: /auth/htpasswd<span class=err>
</span><span class=err></span>            REGISTRY_AUTH_HTPASSWD_REALM: Registry Realm<span class=err>
</span><span class=err></span>        volumes: <span class=err>
</span><span class=err></span>            - ./registry:/var/lib/registry<span class=err>
</span><span class=err></span>            - ./auth:/auth<span class=err>
</span></code></pre></div><p>Tapi jangan dideploy terlebih dahulu! Karena kita harus membuat autentikasi password terlebih dahulu.</p><h3 id=autentikasi>Autentikasi</h3><p>Tentu saja kita ingin, registry kita hanya dimasuki oleh orang yang kita beri akses, untuk itu kita harus membuat autentikasi agar user harus login untuk dapat menggunakan registry ini. Masukkan perintah berikut.</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash><span class=c1>## Buat folder bernama &#34;auth&#34;</span>
mkdir auth
<span class=c1>## Membuat file &#34;htpasswd&#34; didalam folder &#34;auth&#34;, dengan user &#34;blog&#34; &amp; password &#34;blogleon666&#34;</span>
docker run --rm --entrypoint htpasswd registry:2.7.0 -Bbn blog blogleon666 &gt; auth/htpasswd
</code></pre></div><h3 id=deployment>Deployment</h3><p>Step paling gampang yaitu deployment, karena kita hanya akan menjalankan satu perintah saja.</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>docker-compose up -d
</code></pre></div><h3 id=konfigurasi-domain-dan-ssl>Konfigurasi domain dan SSL</h3><p>Pada artikel ini, kita akan menggunakan SSL gratis yaitu <strong>Certbot/LetsEncrypt</strong>. Pertama install terlebih dahulu <strong>Certbot & Nginx</strong>.</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash><span class=c1>## Install Certbot</span>
sudo snap install core<span class=p>;</span> sudo snap refresh core
sudo snap install --classic certbot
sudo ln -s /snap/bin/certbot /usr/bin/certbot

<span class=c1>## Install Nginx Debian Base</span>
sudo apt install nginx -y
<span class=c1>## Install Nginx Arch Base</span>
sudo pacman -Sy nginx
</code></pre></div><h4 id=reverse-proxy>Reverse Proxy</h4><p>Buat reverse proxy terlebih dahulu untuk mengalihkan IP Address server dengan domain yang kita miliki. Kita tidak perlu membuat konfigurasi untuk HTTPS karena nantinya akan di<em>generate</em> otomatis oleh Certbot.</p><div class=highlight><pre class=chroma><code class=language-javascript data-lang=javascript><span class=c1>// Gunakan text editor favorit kalian
</span><span class=c1></span><span class=nx>cd</span> <span class=o>/</span><span class=nx>etc</span><span class=o>/</span><span class=nx>nginx</span><span class=o>/</span><span class=nx>sites</span><span class=o>-</span><span class=nx>available</span>
<span class=nx>sudo</span> <span class=nx>nano</span> <span class=nx>registry</span><span class=p>.</span><span class=nx>conf</span>

<span class=c1>// Isi dari registry.conf
</span><span class=c1></span><span class=nx>server</span> <span class=p>{</span>
    <span class=nx>client_max_body_size</span> <span class=mi>666</span><span class=nx>M</span><span class=p>;</span>
    <span class=nx>server_name</span> <span class=nx>registry</span><span class=p>.</span><span class=nx>leonprasetya</span><span class=p>.</span><span class=nx>my</span><span class=p>.</span><span class=nx>id</span><span class=p>;</span>
    <span class=nx>location</span> <span class=o>/</span> <span class=p>{</span>
        <span class=nx>proxy_pass</span> <span class=nx>http</span><span class=o>:</span><span class=c1>//172.168.10.1:5000;
</span><span class=c1></span>    <span class=p>}</span>
<span class=p>}</span>

<span class=c1>// Aktifkan reverse proxy
</span><span class=c1></span><span class=nx>sudo</span> <span class=nx>ln</span> <span class=o>-</span><span class=nx>s</span> <span class=o>/</span><span class=nx>etc</span><span class=o>/</span><span class=nx>nginx</span><span class=o>/</span><span class=nx>sites</span><span class=o>-</span><span class=nx>available</span><span class=o>/</span><span class=nx>registry</span><span class=p>.</span><span class=nx>conf</span> <span class=o>/</span><span class=nx>etc</span><span class=o>/</span><span class=nx>nginx</span><span class=o>/</span><span class=nx>sites</span><span class=o>-</span><span class=nx>enable</span>
</code></pre></div><ul><li><code>client_max_body_size</code> adalah limit upload yang diperbolehkan, kalian bisa atur sesuka hati, namun saya lebih suka memberi angka yang demonic!!!</li><li><code>server_name</code> adalah nama domain kalian.</li><li><code>proxy_pass</code> adalah alamat IP Address server yang dideploy container registry.</li></ul><h4 id=sslhttps>SSL/HTTPS</h4><p>Let the magic happen. Dengan Certbot, memasang SSL akan terasa sangat mudah.</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>sudo certbot --email email_anda@gmail.co.id --nginx -d registry.leonprasetya.my.id
</code></pre></div><p>Ketika proses selesai, coba buka file <code>/etc/nginx/sites-available/registry.conf</code> untuk memastikan bahwa konfigurasi SSL sudah berhasil. Jika sudah selesai kurang lebih outputnya akan terlihat seperti ini.</p><div class=highlight><pre class=chroma><code class=language-javascript data-lang=javascript><span class=nx>server</span> <span class=p>{</span>
    <span class=nx>server_name</span> <span class=nx>registry</span><span class=p>.</span><span class=nx>leonprasetya</span><span class=p>.</span><span class=nx>my</span><span class=p>.</span><span class=nx>id</span><span class=p>;</span>
    <span class=nx>location</span> <span class=o>/</span> <span class=p>{</span>
        <span class=nx>proxy_pass</span> <span class=nx>http</span><span class=o>:</span><span class=c1>//172.168.10.1:5000;
</span><span class=c1></span>        <span class=nx>proxy_http_version</span>  <span class=mf>1.1</span><span class=p>;</span>
        <span class=nx>proxy_cache_bypass</span>  <span class=nx>$http_upgrade</span><span class=p>;</span>
        <span class=nx>proxy_set_header</span> <span class=nx>Upgrade</span>           <span class=nx>$http_upgrade</span><span class=p>;</span>
        <span class=nx>proxy_set_header</span> <span class=nx>Connection</span>        <span class=s2>&#34;upgrade&#34;</span><span class=p>;</span>
        <span class=nx>proxy_set_header</span> <span class=nx>Host</span>              <span class=nx>$host</span><span class=p>;</span>
        <span class=nx>proxy_set_header</span> <span class=nx>X</span><span class=o>-</span><span class=nx>Real</span><span class=o>-</span><span class=nx>IP</span>         <span class=nx>$remote_addr</span><span class=p>;</span>
        <span class=nx>proxy_set_header</span> <span class=nx>X</span><span class=o>-</span><span class=nx>Forwarded</span><span class=o>-</span><span class=nx>For</span>   <span class=nx>$proxy_add_x_forwarded_for</span><span class=p>;</span>
        <span class=nx>proxy_set_header</span> <span class=nx>X</span><span class=o>-</span><span class=nx>Forwarded</span><span class=o>-</span><span class=nx>Proto</span> <span class=nx>$scheme</span><span class=p>;</span>
        <span class=nx>proxy_set_header</span> <span class=nx>X</span><span class=o>-</span><span class=nx>Forwarded</span><span class=o>-</span><span class=nx>Host</span>  <span class=nx>$host</span><span class=p>;</span>
        <span class=nx>proxy_set_header</span> <span class=nx>X</span><span class=o>-</span><span class=nx>Forwarded</span><span class=o>-</span><span class=nx>Port</span>  <span class=nx>$server_port</span><span class=p>;</span>
    <span class=p>}</span>
 
    <span class=nx>listen</span> <span class=mi>443</span> <span class=nx>ssl</span><span class=p>;</span> <span class=err>#</span> <span class=nx>managed</span> <span class=nx>by</span> <span class=nx>Certbot</span>
    <span class=nx>ssl_certificate</span> <span class=o>/</span><span class=nx>etc</span><span class=o>/</span><span class=nx>letsencrypt</span><span class=o>/</span><span class=nx>live</span><span class=o>/</span><span class=nx>registry</span><span class=p>.</span><span class=nx>leonprasetya</span><span class=p>.</span><span class=nx>my</span><span class=p>.</span><span class=nx>id</span><span class=o>/</span><span class=nx>fullchain</span><span class=p>.</span><span class=nx>pem</span><span class=p>;</span> <span class=err>#</span> <span class=nx>managed</span> <span class=nx>by</span> <span class=nx>Certbot</span>
    <span class=nx>ssl_certificate_key</span> <span class=o>/</span><span class=nx>etc</span><span class=o>/</span><span class=nx>letsencrypt</span><span class=o>/</span><span class=nx>live</span><span class=o>/</span><span class=nx>registry</span><span class=p>.</span><span class=nx>leonprasetya</span><span class=p>.</span><span class=nx>my</span><span class=p>.</span><span class=nx>id</span><span class=o>/</span><span class=nx>privkey</span><span class=p>.</span><span class=nx>pem</span><span class=p>;</span> <span class=err>#</span> <span class=nx>managed</span> <span class=nx>by</span> <span class=nx>Certbot</span>
    <span class=nx>include</span> <span class=o>/</span><span class=nx>etc</span><span class=o>/</span><span class=nx>letsencrypt</span><span class=o>/</span><span class=nx>options</span><span class=o>-</span><span class=nx>ssl</span><span class=o>-</span><span class=nx>nginx</span><span class=p>.</span><span class=nx>conf</span><span class=p>;</span> <span class=err>#</span> <span class=nx>managed</span> <span class=nx>by</span> <span class=nx>Certbot</span>
    <span class=nx>ssl_dhparam</span> <span class=o>/</span><span class=nx>etc</span><span class=o>/</span><span class=nx>letsencrypt</span><span class=o>/</span><span class=nx>ssl</span><span class=o>-</span><span class=nx>dhparams</span><span class=p>.</span><span class=nx>pem</span><span class=p>;</span> <span class=err>#</span> <span class=nx>managed</span> <span class=nx>by</span> <span class=nx>Certbot</span>
<span class=p>}</span>
<span class=nx>server</span> <span class=p>{</span>
    <span class=k>if</span> <span class=p>(</span><span class=nx>$host</span> <span class=o>=</span> <span class=nx>registry</span><span class=p>.</span><span class=nx>leonprasetya</span><span class=p>.</span><span class=nx>my</span><span class=p>.</span><span class=nx>id</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>return</span> <span class=mi>301</span> <span class=nx>https</span><span class=o>:</span><span class=c1>//$host$request_uri;
</span><span class=c1></span>    <span class=p>}</span> <span class=err>#</span> <span class=nx>managed</span> <span class=nx>by</span> <span class=nx>Certbot</span>
 
    <span class=nx>listen</span> <span class=mi>80</span><span class=p>;</span>
    <span class=nx>server_name</span> <span class=nx>registry</span><span class=p>.</span><span class=nx>leonprasetya</span><span class=p>.</span><span class=nx>my</span><span class=p>.</span><span class=nx>id</span><span class=p>;</span>
    <span class=k>return</span> <span class=mi>404</span><span class=p>;</span> <span class=err>#</span> <span class=nx>managed</span> <span class=nx>by</span> <span class=nx>Certbot</span>
<span class=p>}</span>
</code></pre></div><h3 id=testing>Testing</h3><p>Pemasangan Reverse Proxy dan SSL adalah step terakhir yang kita lalui, sekarang saatnya untuk mencoba container registry yang telah kita deploy.</p><h4 id=login>Login</h4><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash><span class=c1># Login dengan username &amp; password yang kita buat sebelumnya!</span>
docker login registry.leonprasetya.my.id
Username: blog
Password: &lt;password_kita&gt;
WARNING! Your password will be stored unencrypted in /home/leon/.docker/config.json.
Configure a credential helper to remove this warning. See
https://docs.docker.com/engine/reference/commandline/login/#credentials-store
 
Login Succeeded
</code></pre></div><h4 id=pull--push-image>Pull & Push Image</h4><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>docker pull ubuntu:16.04
docker tag ubuntu:16.04 registry.leonprasetya.my.id/my-ubuntu
docker push registry.leonprasetya.my.id/my-ubuntu
docker pull registry.leonprasetya.my.id/my-ubuntu
</code></pre></div><p>Jika tidak paham dengan command berikut, kalian bisa cek pada aritek saya yang sebelumnya yaitu <a class=link href=https://blog.leonprasetya.my.id/p/docker-untuk-pemula target=_blank rel=noopener>Docker Untuk Pemula</a> hehehe&mldr;</p><h3 id=cek-images>Cek Images</h3><p>Pada container registry ini, kita tidak dapat menggunakan perintah docker search seperti biasanya, sebagai gantinya kita bisa melakukan pengecekan atau melihat semua daftar images pada container registry ini menggunakan HTTP request. Seperti contoh.</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>curl -X GET http://blog:blogleon666@registry.leonprasetya.my.id/v2/_catalog
<span class=c1># Output </span>
<span class=o>{</span><span class=s2>&#34;repositories&#34;</span>:<span class=o>[</span><span class=s2>&#34;my-ubuntu&#34;</span>,<span class=s2>&#34;postgres&#34;</span><span class=o>]}</span>
</code></pre></div><p>Kita juga dapat melihat list tags pada sebuah image.</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>curl -X GET http://blog:blogleon666@registry.leonprasetya.my.id/v2/postgres/tags/list
<span class=c1># Output</span>
<span class=o>{</span><span class=s2>&#34;name&#34;</span>:<span class=s2>&#34;postgres&#34;</span>,<span class=s2>&#34;tags&#34;</span>:<span class=o>[</span><span class=s2>&#34;9.6&#34;</span><span class=o>]}</span>
</code></pre></div><h3 id=insecure-container-registry>Insecure Container Registry</h3><p>Seperti yang saya janjikan diawal artikel ini, untuk teman-teman yang tak memiliki domain atau yang benar-benar hanya ingin Container registry ini diakses secara local, namun normalnya jika kalian mengaksesnya menggunakan menggunakan direct IP Address ataupun protokol HTTP, Docker akan melempar error <code>http: server gave http response to https client</code>. Dan inilah yang akan kita bahas pada bab ini. Buat file <strong>daemon.json</strong> untuk membuat list <strong>insecure-registries</strong> (insecure seperti saya).</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>sudo nano /etc/docker/daemon.json
 
<span class=o>{</span>
   <span class=s2>&#34;insecure-registries&#34;</span> : <span class=o>[</span><span class=s2>&#34;172.168.10.1:5000&#34;</span><span class=o>]</span>
<span class=o>}</span>
</code></pre></div><p>Lalu restart Docker kalian terlebih dahulu. Contoh dibawah menggunakan systemd.</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>sudo systemctl restart docker.service
</code></pre></div><p>Lalu kalian bisa login.</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>docker login 172.168.10.1:5000
</code></pre></div><h2 id=konsiderasi>Konsiderasi</h2><p>Sebenarnya ada produk Container Registry lain yang ada seperti <strong>JFrog</strong> dan <strong>Nexus</strong> keduanya memiliki Web Interface yang memudahkan kita untuk me-<em>manage</em> registry, namun saya memilih <strong>Docker</strong> karena deployment yang simple dan minimalist. Selalu ada Pro dan Kontra dalam memilih sesuatu, namun kita hanya harus memilih yang cocok untuk kita pakai.</p><h2 id=penutup>Penutup</h2><p>Oke sekian artikel pada hari ini, saya sangat senang akhirnya bisa menulis lagi, seperti biasa jika ada <strong>pertanyaan/typo/kurang jelas</strong>, kalian bisa berdiskusi pada kolom komentar. Sekian dan terimakasih.</p><h2 id=referensi>Referensi</h2><ul><li><a href=https://stackoverflow.com/questions/31251356/how-to-get-a-list-of-images-on-docker-registry-v2>https://stackoverflow.com/questions/31251356/how-to-get-a-list-of-images-on-docker-registry-v2</a></li><li><a href=https://docs.docker.com/registry/recipes/nginx>https://docs.docker.com/registry/recipes/nginx</a></li><li><a href=https://docs.docker.com/registry/deploying>https://docs.docker.com/registry/deploying</a></li><li><a href=https://medium.com/@dataq/membuat-docker-private-registry-6efe534df4d5>https://medium.com/@dataq/membuat-docker-private-registry-6efe534df4d5</a></li></ul></section><footer class=article-footer><section class=article-tags><a href=/tags/docker/>docker</a>
<a href=/tags/registry/>registry</a>
<a href=/tags/devops/>devops</a></section></footer></article><aside class=related-contents--wrapper><h2 class=section-title>Related contents</h2><div class=related-contents><div class="flex article-list--tile"><article class=has-image><a href=/p/docker-untuk-pemula/><div class=article-image><img src=/p/docker-untuk-pemula/index.8a3f5be48643ce7d84d47aeb6875e707_hu3561eeb3844479899fe4e56a13632573_318896_250x150_fill_box_smart1_2.png width=250 height=150 loading=lazy data-key data-hash="md5-ij9b5IZDzn2E1HrraHXnBw=="></div><div class=article-details><h2 class=article-title>Docker Untuk Pemula</h2></div></a></article><article class=has-image><a href=/p/high-availability-ha-rancher-installation-with-docker/><div class=article-image><img src=/p/high-availability-ha-rancher-installation-with-docker/index.c02baadc27c6aae5a0ee8b135fe0cafd_hufaf80446c1310676cec50cf74fe7b4be_58769_250x150_fill_box_smart1_2.png width=250 height=150 loading=lazy data-key data-hash="md5-wCuq3CfGquWg7osTX+DK/Q=="></div><div class=article-details><h2 class=article-title>High Availability (HA) Rancher Installation with Docker</h2></div></a></article><article class=has-image><a href=/p/setup-kubernetes-cluster-pada-aws-educate-mulai-dari-penyiapan-server-sampai-selesai/><div class=article-image><img src=/p/setup-kubernetes-cluster-pada-aws-educate-mulai-dari-penyiapan-server-sampai-selesai/index.6570f39f1e68506f9d20d7848e800cd9_hud58fbdd7d7f06b1214dd0bfd7cea0c2d_145250_250x150_fill_box_smart1_2.png width=250 height=150 loading=lazy data-key data-hash="md5-ZXDznx5oUG+dINeEjoAM2Q=="></div><div class=article-details><h2 class=article-title>Setup Kubernetes Cluster pada AWS Educate Mulai Dari Penyiapan Server Sampai Selesai</h2></div></a></article><article class=has-image><a href=/p/perbedaan-antara-devops-dan-agile/><div class=article-image><img src=/p/perbedaan-antara-devops-dan-agile/index.55695217b4e5dc44f72cf0518b5986c4_hu6620c7cc13a868051b41a21af30829cf_279528_250x150_fill_box_smart1_2.png width=250 height=150 loading=lazy data-key data-hash="md5-VWlSF7Tl3ET3LPBRi1mGxA=="></div><div class=article-details><h2 class=article-title>Perbedaan antara Devops dan Agile</h2></div></a></article><article class=has-image><a href=/p/instalasi-kong-api-gateway-konga-dengan-docker-compose/><div class=article-image><img src=/p/instalasi-kong-api-gateway-konga-dengan-docker-compose/index.d71d7c8b85521c535cf7fd0b36648ad0_huac923ffed9f767788bc20bb1b6e92f9f_260380_250x150_fill_box_smart1_2.png width=250 height=150 loading=lazy data-key data-hash="md5-1x18i4VSHFNc9/0LNmSK0A=="></div><div class=article-details><h2 class=article-title>Instalasi Kong Api Gateway & KONGA dengan Docker Compose</h2></div></a></article></div></div></aside><div class=disqus-container><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return}var b=document,a=b.createElement('script');a.async=!0,a.src='//ledleledles-blog.disqus.com/embed.js',a.setAttribute('data-timestamp',+new Date),(b.head||b.body).appendChild(a)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style><script>window.addEventListener('onColorSchemeChange',a=>{DISQUS&&DISQUS.reset({reload:!0})})</script><footer class=site-footer><section class=copyright>&copy;
2019 -
2021 Leon's Blog</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=2.2.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css integrity="sha256-c0uckgykQ9v5k+IqViZOZKc47Jn7KQil4/MP3ySA3F8=" crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE=" crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g=" crossorigin=anonymous defer></script><script type=text/javascript src=/ts/main.js defer></script><script>(function(){const a=document.createElement('link');a.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",a.type="text/css",a.rel="stylesheet",document.head.appendChild(a)})()</script></body></html>